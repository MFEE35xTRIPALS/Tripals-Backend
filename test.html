<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"
		integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ=="
		crossorigin="anonymous"
		referrerpolicy="no-referrer"
	></script>
	<body>
		<!-- 要上傳的圖片 -->
		<input
			type="file"
			id="fileInput"
			accept="image/*"
			onchange="handleFileInputChange()"
			name="mainImage"
		/>

		<!-- 用來顯示上傳後的圖片 -->
		<img id="previewImage" />

		<!-- 用來顯示上傳進度 -->
		<div id="progressBar"></div>
		<div id="message"></div>
		<script>
			function handleFileInputChange() {
				const fileInput = document.getElementById("fileInput");
				const previewImage = document.getElementById("previewImage");
				const progressBar = document.getElementById("progressBar");
				const message = document.getElementById("message");

				// 檢查是否選擇了檔案
				if (!fileInput.files.length) {
					return;
				}

				// 預覽選擇的圖片
				const file = fileInput.files[0];
				const reader = new FileReader();
				reader.readAsDataURL(file);
				reader.onload = () => {
					previewImage.src = reader.result;
				};

				// 構建 FormData 對象
				const formData = new FormData();
				formData.append("mainImage", file);

				// 發送 POST 請求上傳圖片
				axios
					.post(
						"http://localhost:3000/guide/upload/main?main_articleno=2",
						formData,
						{
							onUploadProgress: (progressEvent) => {
								// 顯示上傳進度
								const percentCompleted = Math.round(
									(progressEvent.loaded * 100) / progressEvent.total
								);
								progressBar.style.width = `${percentCompleted}%`;
								progressBar.innerHTML = `${percentCompleted}%`;
							},
						}
					)
					.then((response) => {
						// 上傳成功，動態新增一個段落元素，顯示上傳成功的訊息
						const p = document.createElement("p");
						p.innerHTML = "上傳成功！";
						message.appendChild(p);
					})
					.catch((error) => {
						// 上傳失敗
						console.log(error.message);
					})
					.finally(() => {
						// 重置表單
						fileInput.value = "";
						previewImage.src = "";
						progressBar.style.width = "0%";
						progressBar.innerHTML = "";
					});
			}
		</script>
	</body>
</html>
